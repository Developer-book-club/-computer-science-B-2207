## TCP/IP 4계층 모델

[<img src="https://upload.wikimedia.org/wikipedia/commons/d/d7/Application_Layer.png" width="450"/>](https://media.geeksforgeeks.org/wp-content/uploads/20201024233154/MVPSchema.png)<br/>
[출처](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C_%EC%8A%A4%EC%9C%84%ED%8A%B8)

### 프로토콜

클라이언트와 서버 간 통신시 데이터 구성요소와 전송방식에 대해 정해둔 규약.<br/>레이어마다 따라야 할 프로토콜들이 있다.

### 어플리케이션 계층

- FTP, HTTP, SSH, SMTP, DNS 프로토콜 이용
- PDU 명칭은 '메시지'
- 서비스를 제공하는 레이어

### 전송 계층

- TCP, UDP 프로토콜 이용
- PDU 명칭은 '세그먼트, 데이터 그램'
- TCP 와 UDP의 차이는 패킷 사이의 순서 보장 여부이다.
- TCP의 경우 지정된 회선으로 패킷이 전송된 순서대로 도착한다.(가상회선 패킷교환 방식) 반면 UDP의 경우 각 세그먼트 혹은 데이터그램이 가장 효율적인 루트를 선택해 순서에 상관없이 최대한 빨리 전송(데이터그램 패킷 교환 방식)되므로 실시간 스트리밍 서비스에 적합한 방식이다.

#### TCP연결 : 3-way-handshake (UDP에는 없는 과정)

1. [SYN] 클라이언트 -> 서버

- (c-ISN)

ISN은 TCP연결의 첫번째 세그먼트에 할당된 임의의 시퀀스 번호이다.

2. [SYN + ACK] 서버 -> 클라이언트

- (s-ISN)
- (c-ISN) + 1

서버의 ISN과, 클라이언트로부터 받은 ISN + 1을 보낸다.

3. [ACK] 클라이언트 -> 서버

- (s-ISN) + 1

서버로부터 받은 ISN + 1을 보낸다.

#### TCP해제 : 4-way-handshake (UDP에는 없는 과정)

1. 클라이언트 -> 서버

- FIN<br/>
  => 클라이언트는 FIN_WAIT_1 상태가 됨

2. 서버 -> 클라이언트

- ACK<br/>
  => 서버는 CLOSE_WAIT 상태가 됨<br/>
  => 클라이언트는 ACK를 받고 FIN_WAIT_2 상태가 됨

...(잠시 대기)

3. 서버 -> 클라이언트

- FIN<br/>
  => 서버는 LAST_ACK 상태가 됨<br/>
  => 클라이언트가 TIME_WAIT 상태가 됨

4. 클라이언트 -> 서버

- ACK<br/>
  => 클라이언트가 TIME_WAIT 상태가 된 후 서버에 ACK를 보냄<br/>
  => 서버는 CLOSED 상태가 됨<br/>
  => 클라이언트 일정시간 대기 후 CLOSED 상태가 됨<br/>
  => 양측 연결자원 전체 해제

#### 해제단계에서 클라이언트의 대기

지연패킷에 대비하고, 클라이언트와 서버가 모두 닫힌 상태가 보장되도록 하기 위함.<br/> OS마다 대기시간은 다르며, 리눅스 계열은 60초, 윈도우는 4분이다.

### 인터넷 계층

- IP, ARP, ICMP 프로토콜 이용
- PDU 명칭은 '패킷'
- IP 목적지로 패킷을 전송하며, 제대로 받았는지는 확인하지 않음

### 링크 계층

- 이더넷 프로토콜 이용
- PDU명칭은 '프레임' , '비트'
- 무선, 유선으로 장치간의 물리적 신호 교환
- MAC주소는 링크계층에서 만들어지는 이더넷 프레임에 포함된다.
- 다른 계층과 달리 전달받은 PDU앞에 헤더만 붙이는 것이 아니라, 맨끝에 프레임 트레일러를 붙인다.

#### 유선 LAN 이더넷 프로토콜에서의 통신방식

1. **전이중화 통신** <br/>
   송신로와 수신로가 나누어져서 양쪽 장치가 동시에 송수신할 수 있는 방식. 속도가 빠르다.

2. **반이중화 통신 (CSMA/CD)** <br/>
   예전에 유선 LAN 통신에서 사용되던 방식.<br/>
   장치가 신호를 수신하기 시작하면 완료될 때까지 기다린 후에 송신할 수 있다.<br/>
   데이터를 보낸 후 충돌이 발생한다면 일정 시간 이후 재전송한다. 송신로와 수신로가 분리되어있지 않기 때문에 충돌이 언제든 발생할 수 있는 구조.<br/>
   <br/>충돌 방지 시스템이 필요하다.

#### 유선 LAN의 물리적인 케이블

유선 LAN을 이루는 물리적인 케이블에는 **TP(twisted pair)케이블**과 **광섬유 케이블**이 대표적으로 사용된다.<br/>
TP케이블은 여덟개의 구리선을 두개씩 꼬아서 묶은 케이블이다. 광섬유 케이블은 레이저를 이용하기에, 구리선과 달리 장거리 고속 통신이 가능하다.

#### 무선 LAN 이더넷 프로토콜에서의 통신방식

반이중화 통신방식 사용

#### 무선 LAN 연결 기술

2.4GHz, 5GHz 주파수 대역을 사용해 신호를 전달할 수 있다.

- 와이파이 : 공유기를 통해 유선 LAN의 신호를 무선 LAN 신호로 바꾸어준다.
- BSS
- ESS
