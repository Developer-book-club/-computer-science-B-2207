## 싱글톤 패턴

> 하나의 클래스에 하나의 인스턴스만 생성된다.
> 모든 모듈에서 단 하나의 인스턴스를 공유한다.

### **장점**
인스턴스 생성 비용 (메모리와 시간)을 아낄 수 있다.


### **단점**
인스턴스를 무조건 하나밖에 만들 수 없으므로 독립적인 단위의 TDD를 수행하기 어렵다. 인스턴스를 만드는 메인모듈에 대한 의존성이 높다.


```
class Singleton
{
    constructor()
    {
        if (!Singleton.instance)
        {
            Singleton.instance = this
        }
        return Singleton.instance
    }
    getInstance()
    {
        return this.instance
    }
}

const a = new Singleton()
const b = new Singleton()
console.log(a === b) // true
```


### **참고**
#### **자바스크립트 객체는 싱글턴으로 생성된다**
자바스크립트에서 리터럴 {} 혹은 new Object로 생성한 객체들은 각각 싱글턴 패턴으로 만들어진 개별적이고 고유한 인스턴스이다.
원시타입 이외의 타입 (참조타입)들은 생성될 때 기존 메모리를 참조하지 않고 새로운 메모리에 만들어지므로, 두개의 참조타입 오브젝트가 가진 프로퍼티 값이 완전히 동일하더라도 두 오브젝트는 서로 '동등'하지 않다. 


#### **DB연결모듈에 싱글턴패턴이 자주 사용된다**
ex) mongoose connect 함수

#### **의존성 주입자를 통한 디커플링**
인스턴스를 만드는 메인모듈에 대한 의존성을 낮추기 위해, 메인모듈과 하위모듈 사이에 의존성 주입자 (추상화) 레이어를 둘 수 있다. 

-> 모듈들의 교체 및 마이그레이션이 수월해지지만, 추상화 레이어로 인한 복잡성의 증가와 런타임 증가가 발생할 수 있다.

<hr/>

### 예상질문
- TDD가 어렵다는 건, 구체적으로 어떻게, 왜?
-> 인스턴스가 가진 데이터를 변경하는 기능을 테스트한다고 할 때, 인스턴스를 여러개 생성할 수 있으면 그냥 새로운 독립적인 인스턴스를 띄워서 잘 가져와지는지 테스트하면 되고, 이는 작업부하가 많이 들지 않는다. 그러나 인스턴스를 하나만 생성해야한다면 테스트용 인스턴스와 기능 동작을 위한 인스턴스가 같으므로 실제 기능을 해야 하는 인스턴스 입장에서는 불필요한 데이터변경이 발생한다.<br/> 이를 방지하기 위해 싱글턴 클래스 자체를 모킹해야 하는데, 모든 기능단위 테스트를 위해 매번 클래스를 모킹하려면 작업부하가 많이 든다. 

