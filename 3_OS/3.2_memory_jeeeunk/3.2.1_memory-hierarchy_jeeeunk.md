## 3.2.1 메모리 계층

- 메모리는 레지스터, 캐시, 메모리, 저장장치 계층으로 구성
- 경제성의 문제로 계층을 두어 관리
- 레지스터로 올라갈수록 속도가 빠르며, 보조기억장치로 내려갈수록 기억 용량이 많음

### 레지스터 Register
- CPU의 프로세서에 위치한 메모리
- 컴퓨터에서 가장 빠르고 휘발성
- 프로세서가 바로 사용할 수 있는 데이터를 담고 있음
- `32bit`, `64bit`: 레지스터의 크기로, CPU를 구분할 때 사용
- 레지스터 크기에 따라 ALU와 버스의 크기도 결정
  - ex) 32bit 레지스터 ->  ALU : 32bit, Bus : 32bit, CPU 다룰수 있는 메모리 : 2^32 (4GB)
  - ex) 64bit 레지스터 ->  ALU : 64bit, Bus : 64bit, CPU 다룰수 있는 메모리 : 2^64 (무한대에 가까움)

### 캐시 Cache

- CPU 내부에 존재하며 레지스터 다음으로 빠른 휘발성 메모리
- CPU가 자주 사용하는 데이터를 복사해 가지고 있어 CPU의 메모리 접근 시간을 줄임
- 성능에 따라 여러 개를 두며, 여기서는 9L1, L2 캐시를 지칭 (L3도 있음)

### 주기억장치 Main Memory, Primary Memory

- CPU와 메인보드와 분리된 메모리 중 최상위 메모리
- CPU에서 직접 접근 가능
- 컴퓨터와 프로세스에 필요한 데이터를 처리
- ROM, RAM이 있으나 보통 RAM을 가리킴
- `RAM (Random Access Memory 임의 접근 기억 장치)`
    - 휘발성 메모리로, CPU 프로세서가 데이터를 읽고 쓸수 있음
    - 전원이 공급되는 동안 CPU는 연산과 동작에 필요한 모든 내용을 여기에 저장
    - 프로그램을 로딩하거나 데이터를 임시 저장하는데 사용
    - 프로그램 실행 시 컴퓨터는 보조기억장치에 저장된 데이터를 주기억장치로 불러오고, CPU가 해당 데이터를 처리
    - 휘발성이므로 실행하고 있는 파일은 보조기억장치에 저장해야 함
    - 현재 CPU가 처리하고 있는 내용을 저장하고 있는 기억장치
- `ROM (Read-Only Memory)`
    - 비휘발성 메모리로, 기억된 데이터 읽기만 가능 (반영구적)
    - 시스템에서 변화하면 안되는 펌웨어와 같은 주요 데이터를 저장

### 보조기억장치 Auxiliary Memory, Secondary Memory

- HDD, SDD
- 물리적인 디스크가 연결된 기억장치로, 사용자가 저장한 데이터를 보관
- 데이터 영구 보관이 가능

### 캐시 Cache

- 데이터를 미리 복사해 두는 임시 저장소
- 메모리 계층 사이 속도 차이로 인한 병목 현상을 줄이기 위한 메모리
- 데이터 접근 시간을 줄이고 다시 계산하는 시간 절약
- 캐싱 계층
    - 계층 사이 속도 차이로 인한 병목 현상을 줄이기 위한 계층
    - 레지스터: 메모리와 CPU 사이의 캐싱 계층
    - 주기억장치: 캐시 메모리와 보조기억장치 사이의 ‘보조기억장치’의 캐싱 계층
- 지역성의 원리
    - 자주 사용하는 데이터의 근거로 사용하는 것
    - 캐싱 데이터를 설정할 때 사용
    - 시간 지역성 Temporal Locality
        - 최근 사용한 데이터에 다시 접근하려는 특성
    - 공간 지역성 Spatial Locality
        - 최근에 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하려는 특성
        
        ```jsx
        let arr = Array.from({length: 10}, () => 0);
        for (let i = 0; i < 10; i ++) {
            arr[i] = i;
        }
        // 변수 i 에 계속 접근: 시간 지역성
        // 변수 i가 배열 arr에 계속 접근: 공간 지역성
        ```
        

### 캐시히트와 캐시미스

- 캐시히트
    - 캐시에서 원하는 데이터를 찾는데 성공한 것
    - 위치도 가깝고 CPU 내부 버스를 기반으로 작동하기에 빠름
- 캐시미스
    - 캐시에서 원하는 데이터를 찾지 못하고 주메모리로 가서 데이터를 찾는 것
    - 시스템 버스를 기반으로 작동하기에 느림
- 캐시매핑
    - 캐시가 히트되기 위해 매핑하는 방법
    - 레지스터는 주메모리 RAM에 비해 매우 작기에, 레지스터가 캐시 계층으로서 역할을 잘 하려면 캐시 매핑이 중요
    - CPU의 레지스터와 주메모리 RAM 사이 데이터를 주고받을 때 기반의 설명
    - 직접 매핑 Directed Mapping
        - 메모리가 1 ~ 100이 있고 캐시가 1 ~ 10이 있다면, 1 : 1 ~ 10, 2 : 2 ~ 10 이런 식으로 매핑하는 방식
        - 처리가 빠르지만 충돌 발생이 잦음
    - 연관 매핑 Associative Mapping
        - 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑하는 방식
        - 충돌이 적지만 모든 블록을 탐색해야 하기에 속도가 느림
    - 집합 연관 매핑 Set Associative Mapping
        - 직접 매핑과 연관 매핑을 혼합한 방식
        - 순서는 일치시키지만 집합으로 묶어 저장하며 블록화 되어있어 검색은 더 효율적
        - 메모리가 1 ~ 100이 있고 캐시가 1 ~ 10이 있다면, 캐시 1 ~ 5에는 1 ~ 50의 데이터를 무작위로 저장하는 것

### 웹 브라우저의 캐시

- 대표적인 SW 캐시
- 사용자의 커스텀 정보나 인증 모듈 관련 사항들을 웹 브라우저에 저장, 추후 서버에 요청을 보낼 때 아이덴티티나 중복 요청 방지를 위해 사용
- 쿠키
    - 만료기간이 있는 `key-value` 저장소 (보통 서버에서 설정)
    - 4KB 까지 저장 가능
    - same site 옵션 strict로 설정하지 않았을 경우 다른 도메인 보내는 요청과 함께 자동 전송
    - 쿠키를 볼 수 없게 `document.cookie` 로 `httponly` 옵션을 걸어야 함
- 로컬 스토리지
    - 만료기한이 없는 `key-value` 저장소 (웹 브라우저를 닫아도 유지)
    - 10MB까지 저장 가능
    - 도메인 단위로 저장, 생성
    - HTML5를 지원하는 브라우저에만 사용 가능
    - 클라이언트에서만 수정 가능
- 세션 스토리지
    - 만료기한이 없는 `key-value` 저장소
    - 5MB까지 저장 가능
    - 탭 단위로 세션 스토리지를 생성, 탭을 닫을 때 삭제
    - HTML5를 지원하는 브라우저에만 사용 가능
    - 클라이언트에서만 수정 가능

### DB의 캐싱 개층

- 메인 DB위에 레디스 redis DB 계층을 둬서 성능을 향상시키기도 함


#### ref
- https://www.quora.com/Is-SSD-RAM-or-ROM